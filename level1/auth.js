var readline = require('readline');

const ins = ["Username: ", "Password: "];

var accounts = {
	0: {
	user: 'admin',
	pass: 'Jhd893HGYT',
	balance: 10000000
	},
	1: {
	user: 'frank',
	pass: 'hacker',
	balance: 10
	}
};

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
});

let inputs = [];

function transfer(i, rl) {
	rl.close();
	rl = readline.createInterface({
		input: process.stdin,
		output: process.stdout,
	});
	rl.question(
		"Enter the account number you wish to transfer to: ",
		(recipient) => {
			rl = readline.createInterface({
				input: process.stdin,
				output: process.stdout
			});
			if (recipient in accounts) {
				amount = accounts[i].balance;
				accounts[i].balance -= amount
				accounts[recipient].balance += amount
				console.log(`Transfer succesful. Your new balance is ${accounts[i].balance}`);
			} else {
				console.log("Invalid account number.");
			}
			rl.close();
	});
}

function authenticate(username, password) {
	for (let i = 0; i < 2; i++) {
		if (username === accounts[i].user) {
			if (password === accounts[i].pass) {
				console.log("Logged in successfuly");

				var authRl = readline.createInterface({
					input: process.stdin,
					output: process.stdout
				});

				authRl.question(
					"Enter 'S' to view balance, 'T' to transfer money or 'I' to view account number: ",
					(action) => {
						switch (action.toUpperCase()) {
							case "S":
								console.log(`Your balance is ${accounts[i].balance}`);
								break;
							case "T":
								transfer(i, authRl);
								break;
							case "I":
								console.log(`Your account number is: ${i}`);
								break;
							default:
								console.log("Invalid option.");
								return;
						}
					}
				);
			} else {
				console.log(`Invalid password for user ${username}`);
			}
			return;
		} else {
			console.log("User not registered");
		}	
	}

}


function getInput(n) {
	const max = 2;
	rl.question(ins[n], (answer) => {
		inputs.push(answer);
		if (n < max - 1) {
        		getInput(n+1);
        	} else {
            		rl.close();
			authenticate(inputs[0], inputs[1]);
		}
    	});
}

console.log(
    "Welcome to Insecure Bank Inc\n"
    + "Please log-in to continue."
);

getInput(0);
